<html>
<head>
  <meta charset="UTF-8">
  <title>JAWS DAYS 2014 九州・沖縄SAMURAIハンズオン：AWS料金体系グランドマスター王者決定戦</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">
  <link rel="stylesheet" href="css/jumbotron-narrow.css">
  <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
  <script src="http://cdn.sockjs.org/sockjs-0.3.4.min.js"></script>
  <script src="vertxbus.js"></script>
  <script src="data.js"></script>

    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>

  <div class="container">
    <div class="header">
      <ul class="nav nav-pills pull-right">
        <li><a href="/viewer/index.html" target="_blank">Viewer</a></li>
      </ul>
	  <h3>JAWS DAYS 2014 九州・沖縄SAMURAIハンズオン<br>
		AWS料金体系グランドマスター王者決定戦</h3>
      <p class="text-muted" id="status">
		Connection Status:&nbsp;
		<span id="status_info">回答サーバに接続できませんでした！ リロードして接続しなおして下さい。</span>

		<button type="button" class="btn btn-warning" onClick="star();">
		  <span class="glyphicon glyphicon-thumbs-up"></span> わっしょい!
		</button>
	  </p>

    </div>



<form>

  <div class="input-group input-group-lg">
	<span class="input-group-addon">@</span>
	<input type="text" class="form-control" id="userName" placeholder="お名前">
  </div>

  <div class="row">
	<div class="col-lg-6">
      <div class="input-group">
		<span class="input-group-addon">
          <input type="radio" name="area" id="area" value="in" checked required/>
		</span>
		<p class="form-control">会場内</p>
      </div><!-- /input-group -->
	</div><!-- /.col-lg-6 -->

	<div class="col-lg-6">
      <div class="input-group">
		<span class="input-group-addon">
          <input type="radio" name="area" id="area" value="remote" required/>
		</span>
		<p class="form-control">会場外（リモートからの参戦）</p>
      </div><!-- /input-group -->
	</div><!-- /.col-lg-6 -->
  </div><!-- /.row -->

  <hr />

  <div id="questions">
	<select id="qSelect">
	</select>
  </div>

  <h1 id="current"></h1>

  <div id="vote">
	<p>回答：$<input type="text" id="price" value="" required/>/Month</p>

    <input type="hidden" id="qId" />
	<p><input type="button" value="回答送信！" onClick="send()" class="btn btn-lg btn-success" /></p>
  </div>
</form>

<div id="send">
  回答履歴:<br>

  <div id="sent" class="innerbox" style="width: 400px; height: 205px;">
  </div>
</div>

<script>
  var eb = null;

  function send() {
    if (eb) {
      var json = {q: $('#qId').val(), userName: $('#userName').val(), area: $('#area').val(), price: $('#price').val()};
      eb.send(ADDR_VOTE, json);

      $('#sent').append($("<code>").text($("#current").text() + " | 回答:" + $('#price').val()));
      $('#sent').append($("</code><br>"));

      $('#price').val("");
    }
  }

  function star() {
    if (eb) {
      eb.send(ADDR_STAR, '');
    }
  }

  function subscribe(address) {
    if (eb) {
      eb.registerHandler(address, function(msg, replyTo) {
        $('#qTitle').append($('<option>').html(msg.text).val(msg.id));
      });
	}
  }

  function openConn() {
    if (!eb) {
      eb = new vertx.EventBus(APP_EB_URL);

      eb.onopen = function() {
        $("#status_info").text("Connected");
        subscribe(ADDR_Q);
      };

      eb.onclose = function() {
        $("#status_info").text("Not connected");
        eb = null;
      };
    }
  }

  $(document).ready(function() {
    openConn();

    for (i=0; i<data.questions.length; i++) {
      var q = data.questions[i];
      $('#qSelect').append($('<option>').html(q.txt).val(q.id));
    }

    $("#qSelect").change(function() {
      var pk = $("#qSelect option:selected").val()
      $("#current").text($("#qSelect option:selected").text());
      $("#qId").val(pk);

      $('#answer').empty();
      for (var key in data["answer"+ pk]) {
        $('#answer').append($('<li>').html(data["answer"+ pk][key]));
      }


    });
    $('#qSelect').trigger('change');
  });

</script>

</body>
</html>
